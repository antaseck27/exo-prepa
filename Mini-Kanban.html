<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Kanban</title>
<style>
  body{font-family:Arial;background:#f5f5f5;margin:0;padding:20px}
  .board{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;max-width:1000px;margin:0 auto}
  .col{background:#fff;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.08);padding:12px;min-height:220px}
  .col h2{margin:0 0 8px}
  .task{padding:10px;margin:8px 0;background:#fafafa;border:1px solid #eee;border-radius:10px;cursor:grab}
  form{max-width:1000px;margin:0 auto 12px;display:flex;gap:8px}
  input,select,button{padding:10px;border:1px solid #ddd;border-radius:10px}
  button{background:#2f80ed;color:#fff;border:0;cursor:pointer}
</style>
</head>
<body>
<form id="f">
  <input id="title" placeholder="Nouvelle tâche..." required>
  <select id="status">
    <option value="todo">À faire</option>
    <option value="doing">En cours</option>
    <option value="done">Terminé</option>
  </select>
  <button>Ajouter</button>
</form>
<div class="board">
  <div class="col" data-col="todo"><h2>À faire (<span data-count="todo">0</span>)</h2></div>
  <div class="col" data-col="doing"><h2>En cours (<span data-count="doing">0</span>)</h2></div>
  <div class="col" data-col="done"><h2>Terminé (<span data-count="done">0</span>)</h2></div>
</div>
<script>
  const KEY='kanban.v1';
  let tasks=[]; try{tasks=JSON.parse(localStorage.getItem(KEY))||[]}catch(e){tasks=[]}
  const cols=document.querySelectorAll('.col');

  function save(){ localStorage.setItem(KEY, JSON.stringify(tasks)); }
  function counts(){ ['todo','doing','done'].forEach(s=>{ document.querySelector(`[data-count="${s}"]`).textContent = tasks.filter(t=>t.status===s).length;}); }
  function render(){
    cols.forEach(c=>c.querySelectorAll('.task').forEach(n=>n.remove()));
    tasks.forEach(t=>{
      const el=document.createElement('div');
      el.className='task'; el.textContent=t.title; el.draggable=true; el.dataset.id=t.id;
      el.addEventListener('dragstart', e=>{ e.dataTransfer.setData('text/plain', t.id); });
      document.querySelector(`.col[data-col="${t.status}"]`).append(el);
    });
    counts();
  }
  cols.forEach(col=>{
    col.addEventListener('dragover', e=>{ e.preventDefault(); });
    col.addEventListener('drop', e=>{
      const id=e.dataTransfer.getData('text/plain');
      const t=tasks.find(x=>String(x.id)===id);
      if(t){ t.status=col.dataset.col; save(); render(); }
    });
  });
  document.getElementById('f').addEventListener('submit', e=>{
    e.preventDefault();
    const title=document.getElementById('title').value.trim();
    const status=document.getElementById('status').value;
    if(!title) return;
    tasks.push({id:Date.now(), title, status});
    e.target.reset(); save(); render();
  });
  render();
</script>
</body>
</html>
